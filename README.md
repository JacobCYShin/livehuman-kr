# ì‹¤ì‹œê°„ AI ë¦½ì‹±í¬ ìŠ¤íŠ¸ë¦¬ë° (í•œêµ­ì–´ ë²„ì „)

ë³¸ í”„ë¡œì íŠ¸ëŠ” ì›ì‘ìì˜ WebRTC ê¸°ë°˜ ë””ì§€í„¸ íœ´ë¨¼ ìŠ¤íŠ¸ë¦¬ë° ì‹œìŠ¤í…œì„ í•œêµ­ì–´ í™˜ê²½ì— ë§ê²Œ ìµœì í™”í•œ ë²„ì „ì…ë‹ˆë‹¤.
`app.py`ë¥¼ ì‹¤í–‰í•˜ë©´ **í•œêµ­ì–´ ìŒì„± ì…ë ¥ì— ìµœì í™”ëœ ë¦½ì‹±í¬ ë””ì§€í„¸ íœ´ë¨¼ ìŠ¤íŠ¸ë¦¬ë°**ì„ ì§ì ‘ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

* livehuman-krì— í•„ìš”í•œ model/dataëŠ” ê°œì¸ì ìœ¼ë¡œ ìš”ì²­í•´ì£¼ì„¸ìš”!

## ë¹ ë¥¸ ì‹¤í–‰ ê°€ì´ë“œ (Quickstart)

```bash
conda activate nerfstream
chcp 65001                # (Windowsì—ì„œ UTF-8 ì¸ì½”ë”© ì„¤ì •)
python app.py --transport webrtc --model wav2lip --avatar_id wav2lip_taeri
```

> ì‹¤í–‰ í›„, ë¸Œë¼ìš°ì €ì—ì„œ ì•„ë˜ ì£¼ì†Œë¡œ ì ‘ì†:
>
> **[http://localhost:8010/dashboard.html](http://localhost:8010/dashboard.html)**

í•„ìˆ˜ íŒŒì¼ ëª©ë¡:

* `dashboard.html`: ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤
* `client.js`: ë¸Œë¼ìš°ì € ìŒì„± ì…ë ¥ ë° WebRTC ì œì–´
* `srs.sdk.js`: SRS WebRTC ë¯¸ë””ì–´ ì„œë²„ SDK

---

## í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ëª¨ë¸ êµ¬ì„±

| í•­ëª©       | ì„¤ëª…                                                     |
| -------- | ------------------------------------------------------ |
| ë¦½ì‹±í¬ ëª¨ë¸   | `Wav2Lip` 256 ë²„ì „ (`wav2lip/models/wav2lip_v4.py`) ì‚¬ìš© ì¤‘ |
| TTS ëª¨ë¸   | `ESPnet` ê¸°ë°˜ í•œêµ­ì–´ TTS (MeloTTSëŠ” Windows ì„¤ì¹˜ ì´ìŠˆë¡œ ì œì™¸ë¨)      |
| LLM      | `polyglot-ko-1.3b-chat` (GPU ë©”ëª¨ë¦¬ ì´ìŠˆë¡œ ì œí•œì ìœ¼ë¡œ ì‚¬ìš©)         |
| ëª¨ë¸ íŒŒì¼ ìœ„ì¹˜ | `models/wav2lip.pth` ê²½ë¡œì— ì €ì¥ í•„ìš”                         |

âœ… Wav2Lip êµ¬ì¡° ìˆ˜ì • ì‹œ:
`wav2lip/models/__init__.py`ì—ì„œ ì•„ë˜ ë¼ì¸ì„ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©í•  ëª¨ë¸ ë²„ì „ì„ ëª…ì‹œí•©ë‹ˆë‹¤:

```python
from .wav2lip_v4 import Wav2Lip, Wav2Lip_disc_qual  # 256 ëª¨ë¸ ì‚¬ìš© ì‹œ
# ë˜ëŠ”
from .wav2lip_v3 import Wav2Lip, Wav2Lip_disc_qual  # 512 ëª¨ë¸ ì‚¬ìš© ì‹œ
```

---

## TTS ì‚¬ìš© ë°©ì‹

ë¡œì»¬ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ TTS ì„œë²„(ESPnet ê¸°ë°˜)ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ í˜¸ì¶œí•©ë‹ˆë‹¤:

```python
class LocalTTS(BaseTTS):
    def txt_to_audio(self, msg):
        text, textevent = msg
        payload = {
            'text': text,
            'sr': 16000,
            'model': 'htr',
            'pre_post_silence_sec': 0.2,
            'intermittent_silence_sec': 0.2,
            'wav_path': 'temp/temp.wav',
            'speed': 1.0
        }
        res = requests.post("http://localhost:7009/api/tts", json=payload)
```

* TTS ì„œë²„ github repo : https://github.com/JacobCYShin/ESPnet-server-kr
* TTS ì„œë²„ ì‹¤í–‰ ëª…ë ¹: `uvicorn app.main:app --host 0.0.0.0 --port 7009`

---

## LLM ì—°ë™ ë°©ì‹
* LLM ì„œë²„ github repo : https://github.com/JacobCYShin/polyglot-1.3b-kr
* Polyglot-Ko ëª¨ë¸ ë¡œì»¬ ì‹¤í–‰: `uvicorn app:app --host 0.0.0.0 --port 8888` (LLMì„ 8888 portì—ì„œ ë„ì›Œì•¼ í•¨)
* WebRTC ì‹œìŠ¤í…œì€ ë‚´ë¶€ì ìœ¼ë¡œ í•´ë‹¹ LLMì„ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µ ìƒì„±ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

---

## ğŸ›  ì„±ëŠ¥ ì¸¡ì • ë° ìµœì í™” ì˜ˆì • ì‘ì—… (ToDo)

* [ ] **MeloTTS ì—°ë™**: Windows ì„¤ì¹˜ ëŒ€ì‘ ë° ëª¨ë¸ ë¡œë”© ì‹œê°„ ìµœì í™”
* [ ] **LLM ì—°ë™ ê°œì„ **: polyglot-ko ì™¸ ê²½ëŸ‰ ëª¨ë¸ ë„ì… ë° ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”
* [ ] **Wav2Lip ê³ ì†í™”**: TorchCompile ë˜ëŠ” ONNX/TensorRT ë³€í™˜ í…ŒìŠ¤íŠ¸ ë° ë¹„êµ ë¶„ì„
* [ ] **ì…ìˆ  ë§ˆìŠ¤í‚¹ ì •ë°€í™”**: ì–¼êµ´ ì „ì²´ ëŒ€ì‹  ì…ìˆ  ì˜ì—­ë§Œ í•©ì„±í•˜ë„ë¡ ëª¨ë¸ ì…ì¶œë ¥ ìˆ˜ì •
---

## ë””ë ‰í† ë¦¬ êµ¬ì¡° (ì¼ë¶€)

```
â”œâ”€â”€ app.py                  # ì‹¤í–‰ ì§„ì…ì 
â”œâ”€â”€ ttsreal.py              # LocalTTS ì •ì˜ (í¬íŠ¸ 7009 í˜¸ì¶œ)
â”œâ”€â”€ webrtc.py               # WebRTC ì‹œê·¸ë„ë§ ì²˜ë¦¬
â”œâ”€â”€ llm.py                  # ë””ì§€í„¸ íœ´ë¨¼ìš© LLM ì‘ë‹µ ì²˜ë¦¬
â”œâ”€â”€ lipreal.py              # Wav2Lip ë¦½ì‹±í¬ ì²˜ë¦¬ (BaseReal ìƒì†)
â”œâ”€â”€ lipasr.py               # ASR ì²˜ë¦¬ (BaseASR ìƒì†)
â”œâ”€â”€ baseasr.py              # ASR ê³µí†µ ë¡œì§
â”œâ”€â”€ basereal.py             # ë””ì§€í„¸ íœ´ë¨¼ ê³µí†µ ì²˜ë¦¬ í´ë˜ìŠ¤
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ dashboard.html      # í´ë¼ì´ì–¸íŠ¸ ëŒ€ì‹œë³´ë“œ
â”‚   â”œâ”€â”€ client.js           # ë¸Œë¼ìš°ì € ì…ë ¥ ë° ì œì–´
â”‚   â”œâ”€â”€ srs.sdk.js          # SRS SDK
â”œâ”€â”€ models/                 # ë¦½ì‹±í¬, ìŒì„± ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸
â”œâ”€â”€ utils/                  # ë””ë²„ê¹…/ë¦¬ì‚¬ì´ì¦ˆ/ì¢Œí‘œ ë³€í™˜ ìŠ¤í¬ë¦½íŠ¸ ë“±
```

---

## coords.pkl (ì–¼êµ´ í•©ì„± ì¢Œí‘œ) ìƒì„± ë°©ë²•

ë””ì§€í„¸ ì•„ë°”íƒ€ì˜ ì–¼êµ´ í•©ì„± ì¢Œí‘œëŠ” `.npy` â†’ `.pkl`ë¡œ ë³€í™˜í•´ì•¼ í•˜ë©°, êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* ë¦¬ìŠ¤íŠ¸ í˜•ì‹: `List[Tuple[np.int64]]`
* ìˆœì„œ: `(y1, y2, x1, x2)`


## ì‹œìŠ¤í…œ êµ¬ì„±ë„

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Client (Browser)  â”‚
                        â”‚  - WebRTC Dashboardâ”‚
                        â”‚  - API Controller  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚ Offer SDP
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        aiohttp Server      â”‚
                    â”‚     (WebRTC + REST API)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  build_nerfreal()    â”‚                    â”‚  REST API Endpoints     â”‚
â”‚  â””â”€â”€ Load Model      â”‚                    â”‚  - /human               â”‚
â”‚  â””â”€â”€ Load Avatar     â”‚                    â”‚  - /humanaudio          â”‚
â”‚  â””â”€â”€ Warm-up         â”‚                    â”‚  - /set_audiotype       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  - /record              â”‚
          â”‚                                 â”‚  - /is_speaking         â”‚
          â–¼                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
 â”‚  LipReal / MuseReal /  â”‚                            â–¼
 â”‚  NeRFReal (BaseReal)   â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚  â””â”€â”€ ASR (LipASR)      â”‚                â”‚    TTS (EdgeTTS, XTTS ë“±)    â”‚
 â”‚  â””â”€â”€ TTS (BaseTTS)     â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â”‚  â””â”€â”€ inference()       â”‚                             â”‚
 â”‚  â””â”€â”€ render()          â”‚ <â”€â”€â”€â”€â”€â”€ call â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         WebRTC PeerConnection (aiortc)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ audio_track â† HumanPlayer.audio       â”‚  â”‚
â”‚  â”‚ video_track â† HumanPlayer.video       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
| êµ¬ì„±ìš”ì†Œ              | ì—­í•                                |
| ----------------- | -------------------------------- |
| Client            | WebRTC ëŒ€ì‹œë³´ë“œ or API ìš”ì²­ì           |
| aiohttp           | WebRTC offer ì²˜ë¦¬ ë° REST API ì œê³µ    |
| build\_nerfreal() | ëª¨ë¸/ì•„ë°”íƒ€ ë¡œë”© ë° ë””ì§€í„¸ íœ´ë¨¼ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±       |
| BaseReal ê³„ì—´       | LipReal, MuseReal ë“± ë””ì§€í„¸ íœ´ë¨¼ ë¡œì§ ìˆ˜í–‰ |
| ASR, TTS          | ì˜¤ë””ì˜¤ ë¶„ì„ ë° í•©ì„± (ì…ë ¥ í…ìŠ¤íŠ¸ â†’ ìŒì„±)        |
| inference()       | Wav2Lip ë“± ì… ëª¨ì–‘ ìƒì„± (ìŒì„± + ì–¼êµ´)      |
| render()          | ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ WebRTC íŠ¸ë™ìœ¼ë¡œ í‘¸ì‹œ           |
| HumanPlayer       | aiortcìš© ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ track ìƒì„±ê¸°        |
| WebRTC PC         | ë¸Œë¼ìš°ì €ì™€ ë¯¸ë””ì–´ íŠ¸ë™ ì†¡ìˆ˜ì‹                  |

---

## ì£¼ìš” íŠ¹ì§•

* **í•œêµ­ì–´ TTS/ASR ì§€ì› (ëª¨ë“  ì£¼ìš” ìŠ¤í¬ë¦½íŠ¸ì— í•œê¸€ ì£¼ì„ í¬í•¨)**
* **ì‹¤ì‹œê°„ WebRTC ê¸°ë°˜ ìŠ¤íŠ¸ë¦¬ë°**
* MuseTalk, Wav2Lip, Ultralight ë””ì§€í„¸ íœ´ë¨¼ ëª¨ë¸ í˜¸í™˜
* íƒ€ì´í•‘í•œ í•œêµ­ì–´ í…ìŠ¤íŠ¸ â†’ ìŒì„± â†’ ë¦½ì‹±í¬ ë¹„ë””ì˜¤ ì¶œë ¥
* ë¸Œë¼ìš°ì € ê¸°ë°˜ ëŒ€í™”í˜• UI ì§€ì›

## ì›ì‘ìì—ê²Œ ê°ì‚¬ì˜ ë§ì”€

ë³¸ ì½”ë“œëŠ” [ì›ì‘ GitHub ë¦¬í¬ì§€í† ë¦¬](https://https://github.com/lipku/LiveTalking)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, í•œêµ­ì–´ í™˜ê²½ ë° TTS/LLM ì—°ë™ ìµœì í™”ë¥¼ ìˆ˜í–‰í•œ í¬í¬ ë²„ì „ì…ë‹ˆë‹¤. ì›ì‘ìì˜ ë…¸ë ¥ì— ê¹Šì´ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.

